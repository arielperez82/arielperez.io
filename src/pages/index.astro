---
// src/pages/index.astro - Personal-focused version
import { getCollection } from 'astro:content'

import Footer from '@/components/Footer'
import Header from '@/components/Header'
import CTA from '@/components/sections/CTA'
import Expertise from '@/components/sections/Expertise'
import Hero from '@/components/sections/Hero'
import Journey, { type ExperienceItem } from '@/components/sections/Journey'
import LatestBlog from '@/components/sections/LatestBlog'
import Media from '@/components/sections/Media'
import { SITE_DESCRIPTION, SITE_TITLE } from '@/consts'
import BaseLayout from '@/layouts/BaseLayout.astro'
import { fetchLatestBlogPosts } from '@/utils/blogPosts'

const siteUrl = 'https://www.arielperez.io'

// Combined schema for homepage
const homepageSchema = {
  '@context': 'https://schema.org',
  '@graph': [
    {
      '@type': 'Person',
      '@id': `${siteUrl}/#person`,
      name: 'Ariel Pérez',
      alternateName: 'Ariel Perez',
      jobTitle:
        'Strategic Product & Technology Leader | Fractional CTO/CPTO | Product & Technology Strategy Advisor',
      description: SITE_DESCRIPTION,
      url: siteUrl,
      image: `${siteUrl}/assets/profile.jpg`,
      sameAs: [
        'https://www.linkedin.com/in/arielxperez',
        'https://twitter.com/arielxperez',
        'https://github.com/arielperez82',
        'https://www.adaptivealchemist.com',
        'https://www.tinybird.co/blog/authors/ariel',
        'https://leaddev.com/community/ariel-perez',
        'https://www.reforge.com/profiles/ariel-perez',
        'https://www.superme.ai/aperez'
      ],
      knowsAbout: [
        'Adaptive Organizations',
        'Fluid Teams',
        'Systems Thinking',
        'Product Engineering',
        'Organizational Transformation',
        'AI & Real-time Data Systems'
      ]
    },
    {
      '@type': 'WebSite',
      '@id': `${siteUrl}/#website`,
      url: siteUrl,
      name: SITE_TITLE,
      description: SITE_DESCRIPTION,
      publisher: {
        '@id': `${siteUrl}/#person`
      },
      potentialAction: {
        '@type': 'SearchAction',
        target: {
          '@type': 'EntryPoint',
          urlTemplate: `${siteUrl}/?s={search_term_string}`
        },
        'query-input': 'required name=search_term_string'
      }
    }
  ]
}

// Fetch publication collection data
const mediaCollection = await getCollection('media')
const sortedMedia = mediaCollection.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
)

// Fetch latest blog posts
const latestPosts = await fetchLatestBlogPosts()

// Get featured items first
const featuredItems = sortedMedia.filter((item) => item.data.featured === true)
const nonFeaturedItems = sortedMedia.filter(
  (item) => item.data.featured !== true
)

// Combine featured items with most recent non-featured items to get 6 total
const selectedItems = [
  ...featuredItems,
  ...nonFeaturedItems.slice(0, Math.max(0, 6 - featuredItems.length))
].slice(0, 6)

const media = selectedItems.map((item) => ({
  title: item.data.title,
  description: item.data.description,
  type: item.data.type,
  url: item.data.url,
  date: item.data.date,
  publication: item.data.publication,
  image: item.data.image,
  additionalLinks: item.data.additionalLinks
}))

// Your expertise areas
const expertise = [
  {
    title: 'Adaptive Organizations',
    description:
      "Cross-functional velocity isn't about better processes but rather, about removing the boundaries that force people to coordinate instead of collaborate.",
    expandedDescription:
      'I design organizations that bend without breaking. Most companies create silos that slow everything down. I build fluid systems where teams form around problems, not departments, and where coordination happens through shared understanding rather than endless meetings.'
  },
  {
    title: 'Product & Engineering Excellence',
    description:
      'Product & engineering speed problems are usually clarity problems. When teams know exactly what success looks like, they stop debating and start building.',
    expandedDescription:
      "I build teams that ship fast because they think fast. This isn't about better developers, product managers, or shinier tools. It's about systems that make the right decisions obvious and the wrong ones impossible."
  },
  {
    title: 'Strategic Product & Engineering Leadership',
    description:
      'Startup velocity comes from treating product-engineering as a single discipline focused on customer outcomes, not separate functions optimizing their own metrics.',
    expandedDescription:
      "I believe product and technology are inseparable disciplines. The fastest-growing companies I've worked with succeed because their product and engineering leaders think as one brain, not two departments fighting for resources."
  },
  {
    title: 'AI & Real-time Data Systems',
    description:
      'AI systems that actually work in production require fundamentally different team structures and data architectures than traditional software.',
    expandedDescription:
      "I lead AI-first product development and data infrastructure that powers intelligent decision-making. The companies winning with AI aren't just adding features. They're redesigning how their entire business learns and adapts."
  }
]

// Experience journey - in reverse chronological order
const experience: ExperienceItem[] = [
  {
    type: 'single',
    role: 'Head of Product & Technology, Field CTO',
    company: 'Tinybird',
    period: '2024 - Present',
    description:
      ' AI-first development requires fundamentally different team structures and approaches — stability comes from cross-team operations, sustainable growth requires intelligent cost management and optimization',
    logo: '/assets/logos/tinybird-logo.jpg',
    logoAlt: 'Tinybird logo'
  },
  {
    type: 'single',
    role: 'VP of Engineering - Measurement & Learning',
    company: 'Split Software (acquired by Harness)',
    period: '2022 - 2024',
    description:
      'Transformed product & engineering culture achieving 6x product releases and 10x deployment frequency while saving $1.2M annually',
    logo: '/assets/logos/split-logo.jpg',
    logoAlt: 'Split Software logo'
  },
  {
    type: 'single',
    role: 'Head of Digital and Communications Platforms, Head of Marketing Technology',
    company: 'JP Morgan Chase - Chase International Consumer Bank (Chase UK)',
    period: '2019 - 2022',
    description:
      'Built mobile-first, cloud-native digital banking from scratch while learning regulation drives innovation',
    logo: '/assets/logos/chase-uk-logo.png',
    logoAlt: 'Chase UK logo - white background blue octagon'
  },
  {
    type: 'single',
    role: 'Head of Product & Engineering - Dark Canary, Head of Core Web Engineering and Solution Architecture',
    company: 'JP Morgan Chase - Chase Digital (Chase Online/Chase Mobile)',
    period: '2017 - 2019',
    description:
      "Built JPMC's first feature-flagging platform enabling 1,200+ concurrent releases to 65M+ users while optimizing core systems for 4.25-second performance gains.",
    logo: '/assets/logos/chase-logo.jpg',
    logoAlt: 'Chase logo - blue background white octagon'
  },
  {
    type: 'multi',
    role: 'Prior Roles',
    company: 'Various Companies',
    period: '2003 - 2017',
    description:
      'MSCLVR (CTO/Co-founder), Try the World (CTO), Birchbox (Senior Engineer), JP Morgan Wealth Management (Engineering Lead) - Customer obsession beats technical perfection',
    logos: [
      {
        logo: '/assets/logos/msclvr-logo.jpg',
        logoAlt: 'MSCLVR logo',
        company: 'MSCLVR'
      },
      {
        logo: '/assets/logos/try-the-world-logo.png',
        logoAlt: 'Try the World logo',
        company: 'Try the World'
      },

      {
        logo: '/assets/logos/birchbox-logo.jpg',
        logoAlt: 'Birchbox logo',
        company: 'Birchbox'
      },
      {
        logo: '/assets/logos/jpmorgan-logo.jpg',
        logoAlt: 'JP Morgan logo',
        company: 'JP Morgan Chase & Co.'
      },
      {
        logo: '...',
        logoAlt: '...',
        company: '...'
      }
    ]
  }
]

// Industry domains
const domains = [
  'Financial Services',
  'Developer Tools',
  'E-Commerce',
  'AI/ML Platforms',
  'Real-time Analytics',
  'Feature Management & Experimentation',
  'FinTech',
  'AdTech',
  'MarTech',
  'Startups',
  'Scale-ups',
  'Fortune 50'
]

// Experience CTAs
const experienceCTAs = [
  /*{
    variant: 'primary' as const,
    url: '/experience',
    label: 'Read my full story →'
  },*/
  {
    variant: 'primary' as const, //'secondary' as const,
    url: '/cv/Ariel_Perez_Resume_2025.pdf',
    newTab: true,
    label: 'Download Resume'
  }
]
---

<BaseLayout
  title={SITE_TITLE}
  description={SITE_DESCRIPTION}
  schema={homepageSchema}
>
  <Header client:load />

  <Hero
    name="Ariel Pérez"
    title="Engineering Leader & Systems Thinker"
    description="I build high-performing, adaptive, deeply collaborative product & engineering organizations that deliver exceptional value at high velocity. With 20+ years across startups, scale-ups, and Fortune 50s, I bridge product and technology to drive growth—accelerating release cadence, cutting lead times, creating products that matter, and saving millions in operational costs. I lead through systems thinking, cross-functional collaboration, and AI-enabled innovation, building adaptive teams that scale and thrive together."
    primaryCTA={{
      text: "Let's start a conversation",
      href: '#cta'
    }}
    secondaryCTA={{
      text: 'Download resume',
      href: '/cv/Ariel_Perez_Resume_2025.pdf',
      newWindow: true
    }}
    profileImage="/assets/profile.jpg"
    client:load
  />

  <Expertise
    title="What I excel at"
    summary="I transform organizations by building adaptive systems that scale faster than market changes. Whether you're struggling with slow decision-making, siloed teams, or technology that's become a bottleneck, I help you create high-performing, collaborative environments that deliver exceptional value at unprecedented velocity."
    expertise={expertise}
    client:load
  />

  <Journey
    title="Experience"
    subtitle="20+ years learning that slow product and engineering teams aren't slow because of bad developers or old technology. They're slow because their systems make collaboration hard and individual heroics necessary. When you redesign the human systems around how people connect, communicate, and make decisions together, the technical problems solve themselves."
    experience={experience}
    domains={domains}
    ctas={experienceCTAs}
    client:load
  />

  <Media
    title="Media and publications"
    subtitle="Sharing insights on adaptive leadership, organizational transformation, and product & engineering across various platforms"
    media={media}
    viewAllUrl="/media"
    client:load
  />

  <LatestBlog
    title="Latest from my blog"
    subtitle="Exploring adaptive leadership and organizational design at The Adaptive Alchemist"
    posts={latestPosts}
    blogUrl="https://www.adaptivealchemist.com/"
    apiUrl="https://www.adaptivealchemist.com/blog.json"
    client:load
  />

  <!-- Working with me section -->
  <section class="bg-gray-50 py-16 lg:py-24">
    <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
      <div class="mb-12 text-center">
        <h2 class="mb-6 text-3xl font-bold text-gray-900 lg:text-4xl">
          Working with me
        </h2>
        <p class="mb-8 text-xl text-gray-600">
          I love collaborating with organizations and individuals who are
          passionate about building adaptive, high-performing teams and systems.
          Whether through fractional/interim CTO/CPTO engagements, speaking, or
          writing collaborations, I'm always excited to share insights and work
          together on challenging problems.
        </p>
      </div>

      <div class="mb-12 grid gap-8 md:grid-cols-2">
        <div
          class="flex h-full flex-col rounded-lg border border-gray-200 bg-white p-8 shadow-sm"
        >
          <div class="flex-1">
            <h3 class="mb-4 text-xl font-semibold text-gray-900">
              Advisory & fractional leadership
            </h3>
            <p class="mb-4 text-gray-600">
              I work with companies to build systems that adapt faster than
              market changes by transforming your organization through adaptive
              leadership, cross-functional velocity, and strategic product &
              technology alignment.
            </p>
            <p class="mb-4 text-gray-600">
              I don't just diagnose problems. I get hands-on to fix them,
              whether reviewing code, redesigning team structures, or sitting in
              strategy and planning meetings.
            </p>
            <p class="mb-4 text-gray-600">
              <strong>Important Note:</strong> I deliver my services exclusively
              through Adaptive Alchemy, LLC, a US-based consultancy. I focus on delivering
              exceptional value while Adaptive Alchemy handles business operations.
            </p>
          </div>
        </div>

        <div
          class="flex h-full flex-col rounded-lg border border-gray-200 bg-white p-8 shadow-sm"
        >
          <div class="flex-1">
            <h3 class="mb-4 text-xl font-semibold text-gray-900">
              Speaking & collaboration
            </h3>
            <p class="mb-4 text-gray-600">
              I'm passionate about sharing insights on adaptive leadership,
              organizational transformation, and the intersection of technology
              and human systems. Let's explore opportunities to collaborate,
              share knowledge, and push the boundaries of what's possible.
            </p>
            <p class="mb-4 font-bold text-gray-600">Please reach out for:</p>
            <ul class="mb-6 list-inside list-disc space-y-2 text-gray-600">
              <li>Speaking engagements and media appearances</li>
              <li>Writing collaborations and guest posts</li>
              <li>Direct professional networking</li>
              <li>Full-time role opportunities (for compelling fits)</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <CTA
    title="Ready to explore what's possible?"
    description=`The best conversations start with curiosity about what could be different. 
      Whether your team is stuck in coordination overhead, your product and engineering groups aren't aligned, or you're wondering if there's a better way to organize for growth, I'd love to explore what might be possible.`
    primaryButton={{
      text: "Let's start a conversation",
      href: 'mailto:ariel@arielperez.io'
    }}
    secondaryButton={{
      text: 'Learn about my approach',
      href: '/about'
    }}
    background="primary"
    client:load
  />

  <Footer client:load />
</BaseLayout>
